<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anúncios - EcoChain Agro</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f7f3;
      color: #2c3e50;
      padding: 20px;
    }
    header {
      background: #e6f0e6;
      padding: 20px;
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
      color: #4caf50;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .voltar-seta {
      display: inline-block;
      font-size: 1.6rem;
      font-weight: 700;
      color: #4caf50;
      text-decoration: none;
      margin-bottom: 15px;
      user-select: none;
      transition: color 0.3s ease;
      cursor: pointer;
    }
    .voltar-seta:hover { color: #388e3c; }

    .botoes-usuario {
      text-align: right;
      margin-bottom: 15px;
    }
    .btn {
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      color: white;
      transition: background-color 0.3s ease;
      font-size: 1rem;
      user-select: none;
      margin-left: 10px;
    }
    .btn-verde { background-color: #4caf50; }
    .btn-verde:hover { background-color: #388e3c; }
    .btn-amarelo {
      background-color: #fbc02d;
      color: #2c3e50;
    }
    .btn-amarelo:hover { background-color: #f9a825; }
    .btn-vermelho { background-color: #e53935; }
    .btn-vermelho:hover { background-color: #b71c1c; }

    .search-bar {
      max-width: 600px;
      margin: 0 auto 30px auto;
      display: flex;
      gap: 10px;
    }
    .search-bar input {
      flex: 1;
      padding: 12px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .search-bar button {
      padding: 12px 20px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    .search-bar button:hover { background: #388e3c; }

    .anuncios-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      padding: 20px 0;
    }
    .anuncio {
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .anuncio:hover { transform: translateY(-4px); }
    .anuncio h3 {
      font-size: 1.2rem;
      margin-bottom: 10px;
      color: #388e3c;
    }
    .anuncio p {
      font-size: 0.95rem;
      margin-bottom: 6px;
    }
    .anuncio .btn-comprar {
      margin-top: 10px;
      background: #4caf50;
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    .anuncio .btn-comprar:hover { background: #2e7d32; }

    /* Modal de compra */
    .modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: white;
      padding: 25px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.2);
    }
    .modal-content h2 {
      margin-bottom: 15px;
      color: #4caf50;
    }
    .modal-content label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    .modal-content input, .modal-content select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .modal-content .btn-verde {
      width: 100%;
      margin-top: 20px;
    }
    .close-modal {
      float: right;
      font-size: 1.2rem;
      cursor: pointer;
      color: #e53935;
      font-weight: bold;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      font-size: 0.9rem;
      color: #888;
    }
  </style>
</head>
<body>

<a href="index.html" class="voltar-seta" title="Voltar para Home">← Voltar</a>

<div class="botoes-usuario">
  <button class="btn btn-verde" id="btnPerfil" style="display:none;">Perfil</button>
  <button class="btn btn-vermelho" id="btnSair" style="display:none;">Sair</button>
  <button class="btn btn-verde" id="btnCadastro">Cadastro</button>
  <button class="btn btn-amarelo" id="btnLogin">Login</button>
</div>

<header>Anúncios - EcoChain Agro</header>

<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Buscar por tipo, origem, preço..." />
  <button onclick="filtrarAnuncios()">Buscar</button>
</div>

<div class="anuncios-container" id="listaAnuncios"></div>

<!-- Modal de Compra -->
<div class="modal" id="modalCompra">
  <div class="modal-content">
    <span class="close-modal" onclick="fecharModal()">×</span>
    <h2>Finalizar Compra</h2>
    <form onsubmit="finalizarCompra(event)">
      <label for="compraProduto">Produto</label>
      <input type="text" id="compraProduto" readonly />

      <label for="compraOrigem">Origem</label>
      <input type="text" id="compraOrigem" readonly />

      <label for="compraPreco">Preço por tonelada</label>
      <input type="text" id="compraPreco" readonly />

      <label for="compraQuantidade">Quantidade</label>
      <input type="number" id="compraQuantidade" min="0.01" step="0.01" required />

      <label for="compraUnidade">Unidade</label>
      <select id="compraUnidade" required>
        <option value="tonelada">Toneladas</option>
        <option value="kg">Kg</option>
        <option value="m3">m³</option>
      </select>

      <label for="compraPrecoTotal">Preço Total</label>
      <input type="text" id="compraPrecoTotal" readonly style="background:#e0e0e0;" />

      <label for="nomeCompleto">Nome Completo</label>
      <input type="text" id="nomeCompleto" required />

      <label for="emailCompra">Email</label>
      <input type="email" id="emailCompra" required />

      <label for="enderecoEntrega">Endereço de Entrega</label>
      <input type="text" id="enderecoEntrega" required />

      <button type="submit" class="btn btn-verde">Finalizar Pedido</button>
    </form>
  </div>
</div>

<footer>
  <p>© 2025 EcoChain Agro. Todos os direitos reservados.</p>
</footer>

<script>
const anuncios = [
  { titulo: "Cinza de casca de arroz", descricao: "Resíduo agrícola com alta reatividade pozzolânica.", origem: "Agrícola BomCampo", preco: "R$ 180/tonelada" },
  { titulo: "Cinza volante (fly ash)", descricao: "Material pozolânico que reage com cal e aumenta a resistência.", origem: "Usina Termoelétrica ValeCerto", preco: "R$ 300/tonelada" },
  { titulo: "Escória de alto-forno", descricao: "Subproduto da indústria siderúrgica, aumenta resistência e durabilidade.", origem: "Siderúrgica Metálica", preco: "R$ 250/tonelada" },
  { titulo: "Cinza de carvão vegetal", descricao: "Cinza derivada da queima de carvão vegetal, melhora propriedades do concreto.", origem: "Fazenda Verde", preco: "R$ 190/tonelada" },
  { titulo: "Cinza de casca de coco", descricao: "Material pozolânico derivado do coco, bom para concreto sustentável.", origem: "Cooperativa Cocosol", preco: "R$ 220/tonelada" },
  { titulo: "Cinza de bagaço de cana", descricao: "Cinza proveniente da queima do bagaço de cana-de-açúcar.", origem: "Usina CanaForte", preco: "R$ 170/tonelada" },
  { titulo: "Cinza de madeira", descricao: "Resíduo da queima de madeira, com propriedades pozzolânicas.", origem: "Madeireira Sustenta", preco: "R$ 200/tonelada" },
  { titulo: "Cinza de casca de café", descricao: "Subproduto do beneficiamento do café, útil para concreto.", origem: "Cooperativa CaféMais", preco: "R$ 210/tonelada" },
  { titulo: "Cinza de palha de arroz", descricao: "Resíduo agrícola, aumenta a durabilidade do concreto.", origem: "Fazenda Arrozal", preco: "R$ 160/tonelada" },
  { titulo: "Cinza de casca de amendoim", descricao: "Cinza proveniente da casca do amendoim, material pozzolânico.", origem: "Cooperativa AmendoimVerde", preco: "R$ 180/tonelada" }
];

// Controle simples para mostrar/ocultar botões perfil, login, cadastro e sair
const btnPerfil = document.getElementById("btnPerfil");
const btnSair = document.getElementById("btnSair");
const btnCadastro = document.getElementById("btnCadastro");
const btnLogin = document.getElementById("btnLogin");

// Simulação: usuário logado se localStorage tem "usuarioLogado" = "true"
function atualizarBotoes() {
  if (localStorage.getItem("usuarioLogado") === "true") {
    btnPerfil.style.display = "inline-block";
    btnSair.style.display = "inline-block";
    btnCadastro.style.display = "none";
    btnLogin.style.display = "none";
  } else {
    btnPerfil.style.display = "none";
    btnSair.style.display = "none";
    btnCadastro.style.display = "inline-block";
    btnLogin.style.display = "inline-block";
  }
}
atualizarBotoes();

btnSair.addEventListener("click", () => {
  localStorage.removeItem("usuarioLogado");
  atualizarBotoes();
});
btnPerfil.addEventListener("click", () => {
  window.location.href = "perfil.html";
});
btnCadastro.addEventListener("click", () => {
  window.location.href = "cadastro.html";
});
btnLogin.addEventListener("click", () => {
  alert("Funcionalidade de login não implementada neste demo.");
});

// Função para exibir anúncios filtrados ou todos
function exibirAnuncios(lista) {
  const container = document.getElementById("listaAnuncios");
  container.innerHTML = "";
  if (lista.length === 0) {
    container.innerHTML = "<p style='text-align:center; color:#777;'>Nenhum anúncio encontrado.</p>";
    return;
  }
  lista.forEach((a, i) => {
    const div = document.createElement("div");
    div.className = "anuncio";
    div.innerHTML = `
      <h3>${a.titulo}</h3>
      <p>${a.descricao}</p>
      <p><strong>Origem:</strong> ${a.origem}</p>
      <p><strong>Preço:</strong> ${a.preco}</p>
      <button class="btn-comprar" onclick="abrirModal(${i})">Comprar</button>
    `;
    container.appendChild(div);
  });
}

// Filtrar anúncios por busca simples
function filtrarAnuncios() {
  const busca = document.getElementById("searchInput").value.trim().toLowerCase();
  if (!busca) {
    exibirAnuncios(anuncios);
    return;
  }
  const filtrados = anuncios.filter(a => 
    a.titulo.toLowerCase().includes(busca) || 
    a.origem.toLowerCase().includes(busca) || 
    a.descricao.toLowerCase().includes(busca) ||
    a.preco.toLowerCase().includes(busca)
  );
  exibirAnuncios(filtrados);
}

// Modal compra
const modal = document.getElementById("modalCompra");
const compraProduto = document.getElementById("compraProduto");
const compraOrigem = document.getElementById("compraOrigem");
const compraPreco = document.getElementById("compraPreco");
const compraQuantidade = document.getElementById("compraQuantidade");
const compraUnidade = document.getElementById("compraUnidade");
const compraPrecoTotal = document.getElementById("compraPrecoTotal");

let anuncioSelecionado = null;

function abrirModal(indice) {
  anuncioSelecionado = anuncios[indice];
  compraProduto.value = anuncioSelecionado.titulo;
  compraOrigem.value = anuncioSelecionado.origem;
  compraPreco.value = anuncioSelecionado.preco;
  compraQuantidade.value = "";
  compraUnidade.value = "tonelada";
  compraPrecoTotal.value = "";
  modal.style.display = "flex";
}

function fecharModal() {
  modal.style.display = "none";
  anuncioSelecionado = null;
}

// Atualizar preço total ao alterar quantidade ou unidade
function atualizarPrecoTotal() {
  if (!anuncioSelecionado) return;
  const precoString = anuncioSelecionado.preco; // Ex: "R$ 180/tonelada"
  const precoNum = parseFloat(precoString.replace(/[^\d.,]/g, '').replace(',', '.')); // 180
  if (isNaN(precoNum)) {
    compraPrecoTotal.value = "Preço inválido";
    return;
  }

  let qtd = parseFloat(compraQuantidade.value);
  if (isNaN(qtd) || qtd <= 0) {
    compraPrecoTotal.value = "";
    return;
  }
  const unidade = compraUnidade.value;

  // Conversões:
  // 1 tonelada = 1000 kg
  // 1 tonelada = 0.7 m³ (assumindo densidade média, ajustar se precisar)
  let precoTotal = 0;

  switch (unidade) {
    case "tonelada":
      precoTotal = precoNum * qtd;
      break;
    case "kg":
      precoTotal = precoNum * (qtd / 1000);
      break;
    case "m3":
      precoTotal = precoNum * (qtd / 0.7);
      break;
  }

  compraPrecoTotal.value = `R$ ${precoTotal.toFixed(2)}`;
}

compraQuantidade.addEventListener("input", atualizarPrecoTotal);
compraUnidade.addEventListener("change", atualizarPrecoTotal);

// Finalizar compra
function finalizarCompra(event) {
  event.preventDefault();

  // Validação básica já com required
  if (!compraQuantidade.value || !nomeCompleto.value || !emailCompra.value || !enderecoEntrega.value) {
    alert("Por favor, preencha todos os campos obrigatórios.");
    return;
  }

  alert(`Pedido realizado com sucesso!\n
Produto: ${compraProduto.value}
Origem: ${compraOrigem.value}
Quantidade: ${compraQuantidade.value} ${compraUnidade.value}
Preço total: ${compraPrecoTotal.value}
\nObrigado pela sua compra!`);

  fecharModal();
}

// Fechar modal clicando fora do conteúdo
window.onclick = function(event) {
  if (event.target === modal) {
    fecharModal();
  }
};

exibirAnuncios(anuncios);
</script>

</body>
</html>
